<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="style2.css">
	<link rel="icon" type="image/x-icon" href="assets/zkbots.jpg">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
	<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
	<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-4LFTP4042J"></script>
	<script>
		window.dataLayer = window.dataLayer || [];

		function gtag() {
			dataLayer.push(arguments);
		}
		gtag('js', new Date());
		gtag('config', 'G-4LFTP4042J');
	</script>


	<!-- 	PopUPADS -->
	<script data-cfasync="false" async type="text/javascript" src="//sr.stagesforget.com/rcFjjSJOD1OJ3s9II/128767"></script>

	<!-- SHUFFLE BOX -->
	<!-- <script data-cfasync="false" async type="text/javascript" src="//jh.gloamsenceint.com/sU8ybVZcUpVHLx/128768"></script> -->
</head>

<body>
	<a class="error" style="display: none;font-size: 30px;" onclick="window.location='tg\://resolve?domain=zk_bots'">
		<error>Error Occured Report<support style="color: #BB86FC;">&nbsp;@ZK_Bots</support>
		</error>
	</a>
	<div class="wrapper">
		<div class="video-wrapper">
			<nav class="movie-title"> Loading... </nav>
			<video autoplay="true" playsinline muted controls>
				<source class="vidSrc" src="">
			</video>
			<div class="player" id="player">
				<div class="background-blur"></div>
				<div class="top">
					<span class="tab-down">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="download">
							<path
								d="M21,14a1,1,0,0,0-1,1v4a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V15a1,1,0,0,0-2,0v4a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V15A1,1,0,0,0,21,14Zm-9.71,1.71a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l4-4a1,1,0,0,0-1.42-1.42L13,12.59V3a1,1,0,0,0-2,0v9.59l-2.29-2.3a1,1,0,1,0-1.42,1.42Z">
							</path>
						</svg>
						<span class="sizediv" style="color:rgba(40, 40, 40, 0.758);font-weight: 800;"></span>
					</span>
					<!-- <div class="mdisk-link" id="mopenbtn"> 
					    <img width="40px" style="border-radius: 50%;margin-top: -7px;z-index: 100;" src="./assets/zkbots.jpg" alt="">
				        </div> -->
				</div>
				<div class="glass-play">
					<svg fill="#000000" width="800px" height="800px" viewBox="0 0 24 24"
						xmlns="http://www.w3.org/2000/svg">
						<path
							d="M18.54,9,8.88,3.46a3.42,3.42,0,0,0-5.13,3V17.58A3.42,3.42,0,0,0,7.17,21a3.43,3.43,0,0,0,1.71-.46L18.54,15a3.42,3.42,0,0,0,0-5.92Zm-1,4.19L7.88,18.81a1.44,1.44,0,0,1-1.42,0,1.42,1.42,0,0,1-.71-1.23V6.42a1.42,1.42,0,0,1,.71-1.23A1.51,1.51,0,0,1,7.17,5a1.54,1.54,0,0,1,.71.19l9.66,5.58a1.42,1.42,0,0,1,0,2.46Z" />
					</svg>
				</div>



				<!-- <div class="info">
                                    <span class="tab" id="dur" class="dur">00:00</span>
                                </div> -->
			</div>
		</div>
		<div class="buttons-wrapper">
			<div class="playbtn-wrapper">
				<div class="btn playbtn mxplaybtn"><img width="120px" src="./assets/MX Player-cropped.svg" alt="">
				</div>
				<div class="btn playbtn vlcplaybtn"><img width="30px" src="./assets/vlc-media-player.svg" alt="">
					<span><b>VLC</b> PLAYER</span>
				</div>
			</div>
			<div class="downbtn-wrapper">
				<div class="btn downbtn ddownbtn">
					<img src="/assets/downloadbtn.svg" alt=""> DOWNLOAD
				</div>
				<div class="btn downbtn idownbtn">
					<img width="30px" src="./assets/1dm.svg" alt=""> 1DM DOWNLOAD
				</div>
			</div>
			<div class="telebtn-wrapper">
				<div class="btn telebtn">TELEGRAM FILE 📂</div>
			</div>
			<a onclick="window.location='tg\://resolve?domain=zk_bots'">
				<div class="support-wrapper"> Made With Love <support style="color: #BB86FC;">&nbsp;@ZK_Bots</support>
					<div class="heart"></div>
				</div>
			</a>
			<div style='width:100%;height: 250px;overflow:hidden;display: grid;place-items: center;'>
				<center>
					<!--ol banner<script data-cfasync="false" async type="text/javascript" src="//uf.lucencypatrist.com/rTAjDaCdLCFhAJZl/99245"></script>-->
					<script data-cfasync="false" async type="text/javascript" src="//venulaeriggite.com/t9CPj9gOZbYGndNts/70048"></script>
				</center>
			</div>
		</div>
		<div class="disclaimer-wrapper"> This website only provide service that helps you convert Telegram File to link
			easily. You can report the file/video that contains a problem like copyright, porn, violence, etc, we will
			not provide service for those file/videos. Send DMCA: <a
				style="font-size: 15px;color:rgba(0, 255, 255, 0.337);"
				onclick="window.location='tg\://resolve?domain=Zdisk_DMCA_bot'">t.me/Zdisk_DMCA</a>
		</div>
	</div>
	<script>
		main()
		async function main() {
			loc = location + ""
			var paramv = loc.split("?=").slice(-1)[0]
			const tuid = paramv.split('/').slice(-1)[0]
			var type = paramv.split("/")[1]
			const uid = decryptUid(tuid)
			file = await getFile(uid)
			paramv = paramv.replace(tuid, uid)
			paramv = paramv.replaceAll('/', '--')
			console.log(file)
			fn = file.fn
			siz = file.siz
			cid = file.cid
			mid = file.mid
			domain = ['stream.zply.fun'][Random(1)]
			if (mid == undefined && type != "m") {
				loadError()
			} else if (mid == undefined && type == "m") {
				mid = tuid
				tglink = `tg://resolve?domain=Files_GiverBot&start=${paramv}`
				slink = `https://${domain}/stream/1749696923/${mid}/file.mkv`
				slink = `https://${domain}/download/1749696923/${mid}/file.mkv`
				assingbtns(slink, tglink, "Zdisk File")
				renderPage("Zdisk File", "", type = type)
				return
			}
			tglink = `tg://resolve?domain=Files_GiverBot&start=${paramv}`
			slink = `https://${domain}/stream/${cid.toString().replace("-100", "")}/${mid}/${fn}`
			slink = `https://${domain}/download/${cid.toString().replace("-100", "")}/${mid}/${fn}`
			renderPage(fn, siz, type = type)
			assingbtns(slink, tglink, fn)
			getPoster(fn)
		}

		function decryptUid(text) {
			let result = "";
			for (let i = 0; i < text.length; i++) {
				let char = text[i];
				if (/[a-zA-Z]/.test(char)) { // Check if character is a letter
					let shift = -2;
					let start = char === char.toUpperCase() ? 'A'.charCodeAt(0) : 'a'.charCodeAt(0);
					// Shift the character and wrap around if necessary
					result += String.fromCharCode((char.charCodeAt(0) - start + shift + 26) % 26 + start);
				} else {
					// Non-alphabet characters are added without decryption
					result += char;
				}
			}
			return result;
		}
		async function getFile(uid) {
			res = await fetch(`https://api.zply.fun/getfile?uid=${uid}`)
			res = await res.json()
			return res
		}

		function renderPage(fn, siz, type = 'u') {
			fn = movieTitle(fn)
			if (type == 'm') {
				eget('.tab-down').style.display = 'none'
			}
			siz = sizeMaker(siz)
			const title = eget('.movie-title')
			const tabDown = eget('.sizediv')
			title.innerHTML = fn
			tabDown.innerHTML = siz
		}

		function assingbtns(slink, tglink, fn) {
			const mxplaybtn = eget('.mxplaybtn')
			const vlcplaybtn = eget('.vlcplaybtn')
			const ddownbtn = eget('.ddownbtn')
			const idownbtn = eget('.idownbtn')
			const telebtn = eget('.telebtn')
			const tabDown = eget('.tab-down')
			const player = eget('.player')
			mxplaybtn.addEventListener("click", () => {
				mxplay(slink, fn)
			})
			vlcplaybtn.addEventListener("click", () => {
				vlcplay(slink)
			})
			ddownbtn.addEventListener("click", () => {
				ddown(slink)
			})
			tabDown.addEventListener("click", () => {
				ddown(slink)
			})
			idownbtn.addEventListener("click", () => {
				idown(slink)
			})
			telebtn.addEventListener("click", () => {
				telefile(tglink)
			})
			player.addEventListener("click", () => {
				loadPlayer(slink)
			})
		}

		function Random(max) {
			return Math.floor(Math.random() * max);
		}

		function loadPlayer(slink) {
			const video = eget('.video-wrapper video')
			const player = eget('.player')
			const source = eget(".vidSrc")
			source.src = slink
			player.style.animation = 'flipOutX'
			player.style.animationDuration = '.5s'
			setTimeout(() => {
				player.style.display = "none";
				video.style.display = "block"
				video.style.animation = 'flipInX'
				video.style.animationDuration = '.5s'
			}, 500)
			video.load()
			video.play();
		}

		function loadError() {
			const error = eget('.error')
			const wrapper = eget('.wrapper')
			wrapper.style.animation = 'zoomOut'
			wrapper.style.animationDuration = '1.5s'
			setTimeout(() => {
				wrapper.style.display = 'none';
				error.style.display = 'block';
				error.style.animation = 'shakeX'
				error.style.animationDuration = '1s'
			}, 800)
		}

		function mxplay(slink, fn) {
			// Encode the URL and title to handle special characters
			const encodedLink = (slink);
			const encodedTitle = (fn);
			window.location.href = `intent:${encodedLink}#Intent;package=com.mxtech.videoplayer.ad;S.title=${encodedTitle};b.decode_mode=2;S.download_url=${encodedLink};end`;
			playstore("com.mxtech.videoplayer.ad");
		}

		function vlcplay(slink) {
			window.location.href = `vlc://${slink.replace(/https?:\/\//, '')}`;
			playstore("org.videolan.vlc")
		}

		function ddown(slink) {
			window.location = slink
		}

		function idown(slink) {
			window.location = `intent:${slink}#Intent;action=android.intent.action.VIEW;package=idm.internet.download.manager;end`
			playstore("idm.internet.download.manager")
		}

		function telefile(tglink) {
			window.location = tglink
		}
		//external
		function getMobileOperatingSystem() {
			var userAgent = navigator.userAgent || navigator.vendor || window.opera;
			// Windows Phone must come first because its UA also contains "Android"
			if (/windows phone/i.test(userAgent)) {
				return "Windows Phone";
			}
			if (/android/i.test(userAgent)) {
				return "Android";
			}
			// iOS detection from: http://stackoverflow.com/a/9039885/177710
			if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
				return "iOS";
			}
			return "unknown";
		}

		function playstore(package) {
			// Wait for the app to launch or fail
			const checkInterval = setInterval(() => {
				// Check if the app was launched successfully
				const now = new Date().getTime();
				if (now - startTime > 2000) { // if more than 2 seconds have passed
					clearInterval(checkInterval); // stop checking
					return; // do nothing, since the app was launched successfully
				}
				// Check if the app failed to launch
				if (document.hidden || document.webkitHidden) { // app did not launch successfully
					clearInterval(checkInterval); // stop checking
					// Redirect the user to the Google Play Store
					if (getMobileOperatingSystem() == "iOS") {
						window.location.href = "https://apps.apple.com/in/app/vlc-media-player/id650377962"
					}
					window.location.href = 'https://play.google.com/store/apps/details?id=' + package;
				}
			}, 100);
		}

		function movieTitle(title) {
			let usn = title.match(/([@#][A-Za-z0-9_]+)/g);
			if (usn) {
				if (usn[0].length < 20) {
					title = title.replace(usn[0], "");
				} else {
					title = title.replace(usn[0].split("_")[0], "");
				}
			}
			title = title.replace(/\(|\)|:|_|\[|\]|-|\n|\./g, " ").trim();
			title = title.replace(/\s+/g, " ");
			title = title.replace(/Blu Ray/g, "BluRay");
			title = title.replace(/Telegram|channel|Channel|Movies|\bTg|\bTG|\btg/g, "");
			title = title.replace(/\s+/g, " ");
			return title;
		}
		async function getPoster(fn) {
			title = fn.toString()
			title = movieTitle(title)
			title = title.replace(/[_\s]/g, '.')
			title = title.replace(/[0-9]/g, '')
			title = title.split(".")
			newtitle = ""
			var found_once = false
			for (i = 0; i <= 4; i++) {
				console.log("running")
				// try{
				newtitle = newtitle + " " + title[i]
				res = await fetch("https://api.themoviedb.org/3/search/multi?include_adult=false&language=en-US&page=1&api_key=59946f4bbcd5722b93d16b4c3c447aef&query=" + newtitle)
				res = await res.json()
				console.log(res, newtitle)
				res = res['results'][0]
				if (res == undefined && !found_once) {
					newtitle = title[i];
					continue
				}
				if (res == undefined && found_once) {
					break
				}
				res = res['backdrop_path']
				if (res == null && !found_once) {
					newtitle = title[i];
					continue
				}
				if (res == null && found_once) {
					break
				}
				found_once = true
				poster = 'https://image.tmdb.org/t/p/w780' + res
				player = eget(".player")
				player.style.background = `url(${poster}) center`
				player.style.backgroundSize = "100%"
				eget(".background-blur").style.backdropFilter = "blur(3px)";
				// } catch(err) {iget("player").style.background = "black"}
			}
		}
		// UTILS
		function showbody(data) {
			var show = document.getElementById("showbody")
			show.innerHTML = data
		}

		function eget(e) {
			var k = document.querySelector(e)
			return k
		}

		function sizeMaker(fileSizeInBytes) {
			var i = -1;
			var byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];
			do {
				fileSizeInBytes /= 1024;
				i++;
			} while (fileSizeInBytes > 1024);
			return Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];
		}

		function encrypt(text) {
			var encryptedText = "";
			for (var i = 0; i < text.length; i++) {
				var charCode = text.charCodeAt(i);
				if (charCode >= 97 && charCode <= 122) { // lowercase letters
					encryptedText += String.fromCharCode(((charCode - 97 + 2) % 26) + 97);
				} else if (charCode >= 65 && charCode <= 90) { // uppercase letters
					encryptedText += String.fromCharCode(((charCode - 65 + 2) % 26) + 65);
				} else {
					encryptedText += text.charAt(i); // non-alphabetic characters
				}
			}
			return encryptedText;
		}

		function decrypt(encryptedText) {
			var decryptedText = "";
			for (var i = 0; i < encryptedText.length; i++) {
				var charCode = encryptedText.charCodeAt(i);
				if (charCode >= 97 && charCode <= 122) { // lowercase letters
					decryptedText += String.fromCharCode(((charCode - 97 - 2 + 26) % 26) + 97);
				} else if (charCode >= 65 && charCode <= 90) { // uppercase letters
					decryptedText += String.fromCharCode(((charCode - 65 - 2 + 26) % 26) + 65);
				} else {
					decryptedText += encryptedText.charAt(i); // non-alphabetic characters
				}
			}
			return decryptedText;
		}
	</script>

	<script>(function () {
			var userAgent = navigator.userAgent || '';
			var isTelegram = false;
			var result = '';

			// Telegram on Android
			if (userAgent.includes("Android") && typeof window.TelegramWebview !== 'undefined') {
				result = '✅ Opened inside Telegram In-App Browser (Android)';
				isTelegram = true;
			}
			// Telegram on iOS
			else if (userAgent.includes("iPhone") && typeof window.TelegramWebviewProxy !== 'undefined' && typeof window.TelegramWebviewProxyProto !== 'undefined') {
				result = '✅ Opened inside Telegram In-App Browser (iOS)';
				isTelegram = true;
			}
			// Generic Telegram Webview
			else if (typeof window.TelegramWebview !== 'undefined' || typeof window.TelegramWebviewProxy !== 'undefined') {
				result = '✅ Opened inside Telegram In-App Browser (Unknown Platform)';
				isTelegram = true;
			}
			// Chrome
			else if (/Chrome/i.test(userAgent) && !/Edge|OPR/i.test(userAgent)) {
				result = '🌐 Opened in Google Chrome';
			}
			// Safari
			else if (/Safari/i.test(userAgent) && !/Chrome|Edge|OPR/i.test(userAgent)) {
				result = '🌐 Opened in Safari';
			} else {
				result = '❌ Not opened in Telegram In-App Browser';
			}


			// Try to open externally if Telegram is detected
			if (isTelegram) {
				var currentUrl = window.location.href;

				if (userAgent.includes("Android")) {
					// Open in Chrome via intent
					var cleanUrl = currentUrl.replace(/^https?:\/\//, '');
					var intentUrl = `intent://${cleanUrl}#Intent;package=com.android.chrome;scheme=https;end`;
					window.location.href = intentUrl;
				} else if (userAgent.includes("iPhone")) {
					// Open in Safari
					setTimeout(() => {
						window.open(currentUrl, '_blank');
					}, 800); // small delay to ensure alert is seen
				}
			}
		})();
	</script>

</body>

</html>